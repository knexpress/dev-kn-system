# Booking Collection Database Schema

This document describes the exact structure that the MongoDB `bookings` collection expects for Sales bookings.

## Important Note

The Booking schema has `strict: false`, which means it accepts fields not explicitly defined in the schema. However, this document shows the **actual structure** used in the database based on existing bookings.

## Top-Level Fields

### Required Fields
- `service`: string - Service type (`"uae-to-pinas"` or `"ph-to-uae"`)
- `service_code`: string - Service code (`"UAE_TO_PH"` or `"PH_TO_UAE"`)
- `source`: string - Source of booking (`"sales"` for Sales bookings)
- `status`: string - Booking status (default: `"pending"`)
- `review_status`: string - Review status (`"not reviewed"`, `"reviewed"`, or `"rejected"`, default: `"not reviewed"`)
- `sender`: object - Sender information (see Sender Object below)
- `receiver`: object - Receiver information (see Receiver Object below)
- `items`: array - Array of items (see Items Array below)
- `identityDocuments`: object - Identity document images (see Identity Documents below)
- `created_by_employee_id`: string (ObjectId) - ID of employee creating the booking
- `insured`: boolean - Whether shipment is insured
- `declaredAmount`: number | null - Declared value (required if insured is true, null if false)

### Auto-Generated Fields (Backend generates these)
- `referenceNumber`: string - Unique reference number (auto-generated by backend)
- `_id`: ObjectId - MongoDB document ID (auto-generated)
- `createdAt`: Date - Creation timestamp (auto-generated)
- `updatedAt`: Date - Update timestamp (auto-generated)

### Optional Fields
- `number_of_boxes`: number - Number of boxes (default: 1 or items.length)
- `weight`: number - Weight in kg
- `weight_kg`: number - Weight in kg (same as weight)
- `origin_place`: string - Origin location (e.g., `"Dubai, United Arab Emirates"`)
- `destination_place`: string - Destination location (e.g., `"Manila, Philippines"`)
- `notes`: string - Additional notes
- `additionalDetails`: string - Additional details
- `termsAccepted`: boolean - Whether terms were accepted

## Sender Object Structure

```javascript
{
  firstName: string,              // Required
  lastName: string,               // Required
  fullName: string,               // Required (or auto-generated from firstName + lastName)
  name: string,                   // Required (same as fullName)
  country: string,                // Required: "UNITED ARAB EMIRATES" for UAE_TO_PH, "PHILIPPINES" for PH_TO_UAE
  address: string,                // Required
  addressLine1: string,           // Required (same as address)
  completeAddress: string,        // Required (full address with country)
  deliveryOption: string,         // Required: "pickup" or "warehouse"
  phone: string,                  // Required (phone number with country code)
  phoneNumber: string,            // Required (same as phone)
  contactNo: string,              // Required (same as phone)
  email: string | undefined,      // Optional
  emailAddress: string | undefined, // Optional (same as email)
  agentName: string | undefined   // Optional (only for UAE sender)
}
```

## Receiver Object Structure

```javascript
{
  firstName: string,              // Required
  lastName: string,               // Required
  fullName: string,               // Required (or auto-generated from firstName + lastName)
  name: string,                   // Required (same as fullName)
  country: string,                // Required: "PHILIPPINES" for UAE_TO_PH, "UNITED ARAB EMIRATES" for PH_TO_UAE
  address: string,                // Required
  addressLine1: string,           // Required (same as address)
  completeAddress: string,        // Required (full address with country)
  deliveryOption: string,         // Required: "pickup" or "delivery"
  phone: string,                  // Required (phone number with country code)
  phoneNumber: string,            // Required (same as phone)
  contactNo: string,              // Required (same as phone)
  email: string | undefined,      // Optional
  emailAddress: string | undefined // Optional (same as email)
  // Note: receiver does NOT have agentName field
}
```

## Items Array Structure

Each item in the array:

```javascript
{
  id: string,                     // Item ID (optional, can be auto-generated)
  commodity: string,              // Required (item category/name)
  name: string,                   // Required (same as commodity)
  description: string | undefined, // Optional
  qty: number,                    // Required (quantity)
  quantity: number                // Required (same as qty)
}
```

## Identity Documents Object Structure

### For UAE_TO_PH (UAE to Philippines)
```javascript
{
  eidFrontImage: string,          // Required - Base64 encoded UAE ID front image
  eidBackImage: string,           // Required - Base64 encoded UAE ID back image
  philippinesIdFront: string,     // Required - Base64 encoded Philippines ID front image
  philippinesIdBack: string       // Required - Base64 encoded Philippines ID back image
}
```

### For PH_TO_UAE (Philippines to UAE)
```javascript
{
  philippinesIdFront: string,     // Required - Base64 encoded Philippines ID front image
  philippinesIdBack: string,      // Required - Base64 encoded Philippines ID back image
  eidFrontImage: string | null,   // Optional - Base64 encoded UAE ID front image (if available)
  eidBackImage: string | null     // Optional - Base64 encoded UAE ID back image (if available)
}
```

## Complete Example Document Structure

### UAE_TO_PH Booking Example

```json
{
  "service": "uae-to-pinas",
  "service_code": "UAE_TO_PH",
  "source": "sales",
  "status": "pending",
  "review_status": "pending",
  "referenceNumber": "KNXMJO699KQ",
  "created_by_employee_id": "507f1f77bcf86cd799439011",
  "sender": {
    "firstName": "John",
    "lastName": "Doe",
    "fullName": "John Doe",
    "name": "John Doe",
    "country": "UNITED ARAB EMIRATES",
    "address": "Street 123, Dubai",
    "addressLine1": "Street 123, Dubai",
    "completeAddress": "Street 123, Dubai, United Arab Emirates",
    "deliveryOption": "pickup",
    "phone": "+971501234567",
    "phoneNumber": "+971501234567",
    "contactNo": "+971501234567",
    "email": "sender@example.com",
    "emailAddress": "sender@example.com",
    "agentName": "Agent Name"
  },
  "receiver": {
    "firstName": "Juan",
    "lastName": "Dela Cruz",
    "fullName": "Juan Dela Cruz",
    "name": "Juan Dela Cruz",
    "country": "PHILIPPINES",
    "address": "123 Main Street, Manila",
    "addressLine1": "123 Main Street, Manila",
    "completeAddress": "123 Main Street, Manila, Philippines",
    "deliveryOption": "pickup",
    "phone": "+639123456789",
    "phoneNumber": "+639123456789",
    "contactNo": "+639123456789",
    "email": "receiver@example.com",
    "emailAddress": "receiver@example.com"
  },
  "items": [
    {
      "id": "item-1234567890",
      "commodity": "Electronics",
      "name": "Electronics",
      "description": "Laptop",
      "qty": 1,
      "quantity": 1
    }
  ],
  "number_of_boxes": 1,
  "identityDocuments": {
    "eidFrontImage": "data:image/jpeg;base64,/9j/4AAQSkZJRg...",
    "eidBackImage": "data:image/jpeg;base64,/9j/4AAQSkZJRg...",
    "philippinesIdFront": "data:image/jpeg;base64,/9j/4AAQSkZJRg...",
    "philippinesIdBack": "data:image/jpeg;base64,/9j/4AAQSkZJRg..."
  },
  "insured": true,
  "declaredAmount": 1000.00,
  "createdAt": "2026-01-06T12:00:00.000Z",
  "updatedAt": "2026-01-06T12:00:00.000Z"
}
```

### PH_TO_UAE Booking Example

```json
{
  "service": "ph-to-uae",
  "service_code": "PH_TO_UAE",
  "source": "sales",
  "status": "pending",
  "review_status": "pending",
  "referenceNumber": "KNXMJO699KQ",
  "created_by_employee_id": "507f1f77bcf86cd799439011",
  "sender": {
    "firstName": "Maria",
    "lastName": "Santos",
    "fullName": "Maria Santos",
    "name": "Maria Santos",
    "country": "PHILIPPINES",
    "address": "Street 123, Manila",
    "addressLine1": "Street 123, Manila",
    "completeAddress": "Street 123, Manila, Philippines",
    "deliveryOption": "pickup",
    "phone": "+639123456789",
    "phoneNumber": "+639123456789",
    "contactNo": "+639123456789",
    "email": "sender@example.com",
    "emailAddress": "sender@example.com"
  },
  "receiver": {
    "firstName": "Mohammed",
    "lastName": "Al-Rashid",
    "fullName": "Mohammed Al-Rashid",
    "name": "Mohammed Al-Rashid",
    "country": "UNITED ARAB EMIRATES",
    "address": "Street 123, Dubai",
    "addressLine1": "Street 123, Dubai",
    "completeAddress": "Street 123, Dubai, United Arab Emirates",
    "deliveryOption": "pickup",
    "phone": "+971501234567",
    "phoneNumber": "+971501234567",
    "contactNo": "+971501234567",
    "email": "receiver@example.com",
    "emailAddress": "receiver@example.com"
  },
  "items": [
    {
      "id": "item-1234567890",
      "commodity": "Electronics",
      "name": "Electronics",
      "description": "Laptop",
      "qty": 1,
      "quantity": 1
    }
  ],
  "number_of_boxes": 1,
  "identityDocuments": {
    "philippinesIdFront": "data:image/jpeg;base64,/9j/4AAQSkZJRg...",
    "philippinesIdBack": "data:image/jpeg;base64,/9j/4AAQSkZJRg...",
    "eidFrontImage": null,
    "eidBackImage": null
  },
  "insured": false,
  "declaredAmount": null,
  "createdAt": "2026-01-06T12:00:00.000Z",
  "updatedAt": "2026-01-06T12:00:00.000Z"
}
```

## Field Validation Rules

### Service Type Validation
- **UAE_TO_PH**: 
  - `sender.country` must be `"UNITED ARAB EMIRATES"`
  - `receiver.country` must be `"PHILIPPINES"`
  - All 4 identity documents required (EID front/back, PH ID front/back)

- **PH_TO_UAE**:
  - `sender.country` must be `"PHILIPPINES"`
  - `receiver.country` must be `"UNITED ARAB EMIRATES"`
  - Philippines ID front/back required, EID optional

### Delivery Options
- **Sender deliveryOption**: `"pickup"` or `"warehouse"` (for both service types)
- **Receiver deliveryOption**: `"pickup"` or `"delivery"` (for both service types)

### Insurance
- If `insured` is `true`: `declaredAmount` must be a positive number
- If `insured` is `false`: `declaredAmount` should be `null`

### Phone Numbers
- Should include country code (e.g., `+971` for UAE, `+63` for Philippines)
- Can be provided as `phone`, `phoneNumber`, or `contactNo` (backend normalizes)

### Email
- Optional field
- If provided, must be valid email format
- Can be provided as `email` or `emailAddress` (backend normalizes)

## Notes

1. **Auto-Generated Fields**: `referenceNumber` is automatically generated by the backend - do NOT send it from frontend
2. **Field Normalization**: Backend handles multiple field name variations (e.g., `phone`/`phoneNumber`/`contactNo`)
3. **Identity Documents**: Base64 images should include the `data:image/...;base64,` prefix
4. **Strict Mode**: Schema has `strict: false`, so additional fields will be accepted but may not be used
5. **Timestamps**: `createdAt` and `updatedAt` are automatically managed by Mongoose

